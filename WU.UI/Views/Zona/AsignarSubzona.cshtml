@model WU.UI.Controllers.ZonaController
@{
    Layout = "../Shared/_Layout.cshtml";
}

<script type="text/javascript">
    $(function () {
        $('#finicio_001').datetimepicker();
        $('#ffin_001').datetimepicker();
    });
</script>

<h1>WU_CUS001 Asignar Sub Zona a ET</h1>
<div class="row">
    <div class="col-md-8">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Datos</h3>
            </div>
            <div class="panel-body">
                <div class="form-group row">
                    <label for="finicio" class="col-sm-3 col-form-label">Fecha de inicio:</label>
                    <div class="col-sm-5">
                        <div class="input-group date" id="finicio_001">
                            <input type="text" class="form-control ocl-8">
                            <span class="input-group-addon">
                                <span class="glyphicon glyphicon-calendar"></span>
                            </span>
                        </div>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="ffin" class="col-sm-3 col-form-label">Fecha de fin:</label>
                    <div class="col-sm-5">
                        <div class="input-group date" id="ffin_001">
                            <input type="text" class="form-control ocl-8">
                            <span class="input-group-addon">
                                <span class="glyphicon glyphicon-calendar"></span>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-sm-3 col-xs-6">
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" value="">Money Transfer
                            </label>
                        </div>
                    </div>
                    <div class="col-sm-3 col-xs-6">
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" value="">Pago de servicios
                            </label>
                        </div>
                    </div>
                    <div class="col-sm-2  col-xs-12">
                        <a href="#" class="btn btn-primary btn-primary btn-block">Buscar</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-8">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Mapa</h3>
            </div>
            <div class="panel-body" style="padding: 0">
                <!---------------------------MAPA-------------------------->
                <div id="map"></div>
            </div>
        </div>
    </div>
    <!-- form  -->

    @using (Html.BeginForm("RegistrarSubZona", "Zona", FormMethod.Post, new { enctype = "multipart/form-data" }))
    {
        <div class="col-md-4">
            <div class="panel panel-default row">
                <div class="panel-heading">
                    <h3 class="panel-title">Subzona</h3>
                </div>
                <div class="panel-body esp-m">
                    <div class="form-group">
                        <div class="row" style="margin-bottom: 15px;">
                            <label for="ddlZonas" class="col-sm-3 col-form-label">Zonas:</label>
                            <div class="col-sm-9">
                                @{
                                    int cant = Model.zonaBL.ListarZonas().Count();
                                    <select name="ddlZona" class="form-control">
                                        <option>-SELECCIONE-</option>
                                        @for (int i = 0; i < cant; i++)
                                        {
                                            int Cid = Model.zonaBL.ListarZonas().ElementAt(i).codzona;
                                            string nom = Model.zonaBL.ListarZonas().ElementAt(i).dsczona;
                                            <option id="@Cid" value="@Cid">@nom</option>
                                        }
                                    </select>
                                }

                            </div>
                        </div>
                        <div class="row">
                            <label for="ddlZonas" class="col-sm-12 col-form-label">% de captación: 80%</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel panel-default row">
                <div class="panel-heading">
                    <h3 class="panel-title">ET</h3>
                </div>
                <div class="panel-body esp-m">
                    <div class="form-group">
                        <div class="row ">
                            <div class="col-sm-12" style="margin-bottom: 15px; width:100%">
                                @{
                                    int cantET = Model.etBL.ListarET().Count();
                                    <select name="ddlET" class="form-control">
                                        <option>-SELECCIONE-</option>
                                        @for (int i = 0; i < cantET; i++)
                                        {
                                            int Cid = Model.etBL.ListarET().ElementAt(i).codet;
                                            string nom = Model.etBL.ListarET().ElementAt(i).nomet + " " +
                                                        Model.etBL.ListarET().ElementAt(i).apeet;
                                            <option id="@Cid" value="@Cid">@nom</option>
                                        }
                                    </select>
                                }
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-6">
                                <a href="#" class="btn btn-block btn-primary btn-block">Buscar</a>
                            </div>
                            <div class="col-xs-6">
                                <a href="#" class="btn btn-block btn-primary btn-danger">Eliminar</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <textarea id="txtCoord" class="form-control col-md-12" rows="3" cols="5"></textarea>
            </div>
        </div>
        <input type="submit"
               value="Registrar"
               id="btnRegistrar"
               name="btnRegistrar" />
                                    }

    <!-- fin form  -->
</div>

<script type="text/javascript">
    var source = new ol.source.Vector();

    var map = new ol.Map({
        target: 'map',
        layers: [
        new ol.layer.Tile({
            source: new ol.source.OSM()
        }),
        new ol.layer.Vector({
            source: source
        })],
        view: new ol.View({
            projection: 'EPSG:3857',
            center: ol.proj.transform([-77.044, -12.062], 'EPSG:4326', 'EPSG:3857'),
            zoom: 15
        })
    });

    var draw = new ol.interaction.Draw({
        type: 'Polygon',
        source: source,
        style: new ol.style.Style({
            image:
            //Start of the star style
            new ol.style.RegularShape({
                fill: new ol.style.Fill({
                    color: 'red'
                }),
                points: 4,
                radius1: 15,
                radius2: 1,
            }),
            stroke: new ol.style.Stroke({
                color: 'blue',
                width: 2
            })/*,
            fill: new ol.style.Fill({
                color: 'white'
            })*/
        })
    });
    map.addInteraction(draw);


    source.on('addfeature', function (evt) {
        var feature = evt.feature;
        var coords = feature.getGeometry().getCoordinates();
        var res = "";
        var coo = "";
        coords[0].forEach(function (element) {
            res += " < " + element + "> \n";
            coo += element + ";";
        });
        alert(res);
        document.getElementById("txtCoord").value = coo;
        /*
            var GEOJSON_PARSER = new OpenLayers.Format.GeoJSON();
            var vectorLayerAsJson = GEOJSON_PARSER.write(evt.feature);

            console.log("Vector "+vectorLayerAsJson);
        */
    });
</script>

